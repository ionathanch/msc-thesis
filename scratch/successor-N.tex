\documentclass{article}
% \usepackage[utf8]{inputenc} % Not needed for LuaLaTeX or XeLaTeX
\usepackage[margin=1in]{geometry}
\usepackage[colorlinks=true]{hyperref}
\usepackage[natbib=true,maxbibnames=99]{biblatex}
\usepackage[toc]{appendix}
\usepackage{amsmath}
\usepackage{amssymb}
\usepackage{mathpartir}
\usepackage{multicol}
\usepackage{suffix}    % for starred commands via \WithSuffix
\usepackage{mathtools} % for \coloneqq, \mathrlap
\usepackage{fdsymbol}  % for \stareq
\usepackage{xspace}    % for \xspace
\usepackage{xcolor}    % for \colorbox, textcolor
\usepackage{stmaryrd}  % for \Yright
\usepackage{soul}      % for \st

\title{}
\author{Jonathan Chan}

\definecolor{metacolour}{RGB}{238,18,137}
\definecolor{indcolour}{RGB}{0,0,205}
\definecolor{constrcolour}{RGB}{0,139,0}
\definecolor{kwcolour}{RGB}{205,102,0}

\newcommand{\meta}[1]{\mathsf{\textcolor{metacolour}{#1}}}
\WithSuffix\newcommand\meta*[1]{\textsf{\textcolor{metacolour}{#1}}}
\newcommand{\ind}[1]{\mathsf{\textcolor{indcolour}{#1}}}
\newcommand{\constr}[1]{\mathsf{\textcolor{constrcolour}{#1}}}
\newcommand{\kw}[1]{\mathsf{\textcolor{kwcolour}{#1}}}
\newcommand{\target}[1]{\colorbox{lightgray}{$#1$}}

\newcommand{\kwopen}[1]{\kw{#1}\:}
\newcommand{\kwbin}[1]{\:\kw{#1}\:}
\newcommand{\kwclose}[1]{\:\kw{#1}}
\newcommand{\et}{\:}

\newcommand{\pr}[1]{\raisebox{-#1pt}{$^\prime$}}
\newcommand{\taupr}{\tau\pr{2}}
\newcommand{\sigmapr}{\sigma\pr{2}}
\newcommand{\alphapr}{\alpha\pr{3}}

\newcommand{\poly}[2]{\forall #1 \mathpunct{.} #2}
\newcommand{\suc}[1]{\widehat{#1}}
\newcommand{\fun}[3]{\Pi #1 \mathbin{:} #2 \mathpunct{.} #3}
\WithSuffix\newcommand\fun*[2]{\Pi #1 \mathpunct{.} #2}
\renewcommand{\prod}[3]{\Sigma #1 \mathbin{:} #2 \mathpunct{.} #3}
\WithSuffix\newcommand\prod*[2]{\Sigma #1 \mathpunct{.} #2}
\newcommand{\arr}[2]{#1 \mathbin{\rightarrow} #2}
\WithSuffix\newcommand\arr*[3]{(#1 \mathbin{:} #2) \mathbin{\rightarrow} #3}
\newcommand{\lam}[3]{\lambda #1 \mathbin{:} #2 \mathpunct{.} #3}
\WithSuffix\newcommand\lam*[2]{\lambda #1 \mathpunct{.} #2}
\newcommand{\Lam}[2]{\Lambda #1 \mathpunct{.} #2}
\newcommand{\app}[2]{#1 \: #2}
\newcommand{\App}[2]{#1 \: \mathopen{[} #2 \mathclose{]}}
\newcommand{\letin}[3]{\kwopen{let} #1 \mathbin{\coloneqq} \phantom{} #2 \kwbin{in} #3}
\newcommand{\Let}[3]{\kwopen{let} #1 \mathbin{:} #2 \mathbin{\coloneqq} \phantom{} #3}
\newcommand{\Type}[1]{\ind{Type}_{#1}}
\newcommand{\Prop}[1]{\ind{Prop}_{#1}}
\newcommand{\match}[3]{\kwopen{match} #1 \kwbin{return} #2 \kwbin{with} #3}
\newcommand{\fix}[3]{\kwopen{fix} #1 \mathbin{:} #2 \mathbin{\coloneqq} \phantom{} #3}
\WithSuffix\newcommand\fix*[4]{\kwopen{fix}_{#1} #2 \mathbin{:} #3 \mathbin{\coloneqq} \phantom{} #4}
\newcommand{\data}[3]{\kwopen{data} #1 \mathbin{:} #2 \kwbin{where} #3}
\newcommand{\annot}[2]{#1 \mathbin{:} #2}
\newcommand{\define}[2]{#1 \mathbin{\coloneqq} #2}
\newcommand{\elim}{\mathrel{\Yright}}
\newcommand{\Size}{\ind{Size}}
\newcommand{\base}{\constr{base}}
\newcommand{\next}{\constr{next}}
\newcommand{\Eq}{\ind{Eq}}
\newcommand{\refl}{\constr{refl}}
\renewcommand{\equal}[3]{#1 \stackrel{#2}{=\joinrel=} #3}
\newcommand{\eq}[2]{#1 \mathrel{=\joinrel=} #2}
\newcommand{\J}[3]{\constr{J}_{#1} \: #2 \: #3}
\newcommand{\Pair}[2]{#1 \mathbin{\times} #2}
\WithSuffix\newcommand\Pair*[3]{\mathopen{(} #1 \mathbin{:} #2 \mathclose{)} \mathbin{\times} #3}
\newcommand{\pair}[2]{\mathopen{\langle} #1 \mathpunct{,} #2 \mathclose{\rangle}}
\newcommand{\pairs}[2]{\mathopen{\langle} #1 \mathpunct{,} \seq \mathpunct{,} #2 \mathclose{\rangle}}
\newcommand{\prjl}[1]{\pi_{\kw{L}} \: #1}
\newcommand{\prjr}[1]{\pi_{\kw{R}} \: #1}
\newcommand{\some}[2]{\exists #1 \mathpunct{.} #2}
\newcommand{\pack}[2]{\mathopen{(} #1 \mathpunct{,} #2 \mathclose{)}}
\newcommand{\packs}[3]{\mathopen{(} #1 \mathpunct{,} \seq \mathpunct{,} #2 \mathpunct{,} #3 \mathclose{)}}
\newcommand{\unpack}[4]{\kwopen{let} \pack{#1}{#2} \mathbin{\coloneqq} #3 \kwbin{in} #4}
\newcommand{\N}[1]{\App{\ind{\mathbb{N}}}{#1}}
\WithSuffix\newcommand\N*{\ind{\mathbb{N}}}
\newcommand{\Nat}{\ind{Nat}}
\newcommand{\zero}[1]{\App{\constr{zero}}{#1}}
\WithSuffix\newcommand\zero*{\constr{zero}}
\renewcommand{\succ}[2]{\app{\App{\constr{succ}}{#1}}{#2}}
\WithSuffix\newcommand\succ*{\constr{succ}}
\newcommand{\V}[3]{\app{\app{\App{\ind{\mathbb{V}}}{#1}}{#2}}{#3}}
\WithSuffix\newcommand\V*{\ind{\mathbb{V}}}
\renewcommand{\Vec}{\ind{Vec}}
\newcommand{\nil}[2]{\app{\App{\constr{nil}}{#1}}{#2}}
\WithSuffix\newcommand\nil*{\constr{nil}}
\newcommand{\cons}[4]{\app{\app{\app{\App{\constr{cons}}{#1}}{#2}}{#3}}{#4}}
\WithSuffix\newcommand\cons*{\constr{cons}}
\renewcommand{\tt}{\mathopen{\langle}\mathclose{\rangle}}
\newcommand{\Unit}{\ind{Unit}}
\newcommand{\unit}{\constr{unit}}

\newcommand{\mt}{\meta{\cdot}}
\newcommand{\seq}{\,\meta{\dots}\,}
\newcommand{\any}{\meta{\texttt{\_}}}
\newcommand{\idx}{{\meta{i}}}
\newcommand{\FV}{\meta{FV}}
\newcommand{\fresh}[1]{#1 ~ \meta{fresh}}
\newcommand{\maximum}{\meta{\max}}
\newcommand{\lub}[2]{#1 \mathbin{\meta{\sqcup}} #2}
\newcommand{\subst}[3]{#1 \mathopen{\meta{[}} #2 \mathbin{\meta{\mapsto}} #3 \mathclose{\meta{]}}}
\newcommand{\set}[1]{\mathopen{\meta{\{}} #1 \mathclose{\meta{\}}}}
\newcommand{\size}[1]{\mathopen{\meta{\lvert}} #1 \mathclose{\meta{\rvert}}}
\newcommand{\erase}[1]{\mathopen{\meta{\|}} #1 \mathclose{\meta{\|}}}
\newcommand{\compile}[1]{\mathopen{\meta{\llbracket}} #1 \mathclose{\meta{\rrbracket}}}
\newcommand{\compilesto}{\mathrel{\rightsquigarrow}}
\newcommand{\huh}{\meta{???}}
\newcommand{\test}[1]{#1 \coloneqq}

\newcommand{\wf}[2]{#1 \vdash #2}
\newcommand{\conv}[3]{#1 \vdash #2 \mathrel{\approx} #3}
\newcommand{\type}[3]{#1 \vdash #2 \mathbin{\Updownarrow} #3}
\renewcommand{\check}[3]{#1 \vdash #2 \mathbin{\Downarrow} #3}
\renewcommand{\infer}[3]{#1 \vdash #2 \mathbin{\Uparrow} #3}
\newcommand{\red}[4]{#1 \vdash #2 \mathrel{\rhd}_{#3} #4}
\WithSuffix\newcommand\red*[3]{#1 \vdash #2 \mathrel{\rhd}^* #3}

\renewcommand{\sectionautorefname}{Section}
\renewcommand{\subsectionautorefname}{Subsection}
\renewcommand{\subsubsectionautorefname}{Subsubsection}
\renewcommand{\chapterautorefname}{Chapter}
\renewcommand{\appendixautorefname}{Appendix}
\renewcommand{\figureautorefname}{Figure}
\renewcommand{\tableautorefname}{Table}

\addbibresource{biblio.bib}

\begin{document}

\maketitle

\begin{figure}[h]
    \centering
    \begin{align*}
        i, j, k, m, n &\Coloneqq \meta{naturals}
        & r, s &\Coloneqq \alpha \mid \suc{s} \mid \circ \mid \infty 
        & \Gamma &\Coloneqq \mt \mid \Gamma(\annot{x}{\tau}) \mid \Gamma(\define{x}{e}) \mid \Gamma(\alpha) \\
        f, g, w, x, y, z, \alpha, \beta &\Coloneqq \meta{variables}
        & U_i &\Coloneqq \Prop{i} \mid \Type{i}
        & \Delta &\Coloneqq \mt \mid \Delta(\annot{x}{\tau}) \qquad\Phi \Coloneqq \mt \mid \Phi(\alpha) \\
        e, d, p, P, \tau, \sigma &\Coloneqq \mathrlap{x \mid U_{i} \mid \fun{x}{\tau}{\tau} \mid \lam{x}{\tau}{e} \mid \app{e}{e} \mid \poly{\alpha}{\tau} \mid \Lam{\alpha}{e} \mid \App{e}{s} \mid \letin{x}{e}{e}} \\
        &\mid \mathrlap{\prod{x}{\sigma}{\tau} \mid \pair{e}{e}_{\prod{x}{\sigma}{\tau}} \mid \prjl{e} \mid \prjr{e} \mid \some{\alpha}{\tau} \mid \pack{s}{e}_{\some{\alpha}{\tau}} \mid \unpack{\alpha}{x}{e}{e}} \\
        &\mid \mathrlap{\equal{e}{\tau}{e} \mid \refl_{e} \mid \J{P}{d}{p}} \\
    \end{align*}
    \caption{Syntax}
    \label{fig:syntax}
\end{figure}

\begin{figure}[h]
    \centering
    \begin{align*}
        s + 0 &\equiv s
        & \arr{\tau_1}{\tau_2} &\equiv \fun{\any}{\tau_1}{\tau_2}
        & \Pair{\tau_1}{\tau_2} &\equiv \prod{\any}{\tau_1}{\tau_2} \\
        s + n &\equiv \suc{s} + (n \mathbin{\meta{-}} 1)
        & \arr{\Delta}{\tau} &\equiv \fun{x_n}{\tau_1}{\seq \fun{x_n}{\tau_n}{\tau}}
        & \Pair{\Delta}{\tau} &\equiv \prod{x_1}{\tau_1}{\seq \prod{x_n}{\tau_n}{\tau}} \\
        \top &\equiv \fun{\tau}{\Prop{0}}{\fun{\any}{\tau}{\tau}}
        & \poly{\Phi}{\tau} &\equiv \poly{\alpha_1}{\seq \poly{\alpha_n}{\tau}}
        & \some{\Phi}{\tau} &\equiv \some{\alpha_1}{\seq \some{\alpha_n}{\tau}} \\
        \tt &\equiv \lam{\tau}{\Prop{0}}{\lam{x}{\tau}{x}}
        & \lam*{\Delta}{e} &\equiv \lam{x_1}{\tau_1}{\seq \lam{x_n}{\tau_n}{e}}
        & \pairs{e_1}{e_n} &\equiv \pair{e_1}{\seq \pair{e_n}{\tt}}  \\
        \bot &\equiv \fun{\tau}{\Prop{0}}{\tau}
        & \Lam{\Phi}{e} &\equiv \Lam{\alpha_1}{\seq \Lam{\alpha_n}{e}}
        & \packs{s_1}{s_n}{e} &\equiv \pack{s_1}{\seq \pack{s_n}{e}} \\
        &&\mathrlap{\textit{where} ~ \Delta \equiv (\annot{x_1}{\tau_1}) \seq (\annot{x_n}{\tau_n}), \Phi \equiv (\alpha_1) \seq (\alpha_n)}
    \end{align*}
    \begin{align*}
        \app{e}{\Delta} &\equiv \app{\app{e}{x_1} \seq}{x_n} \\
        \subst{e}{z_1 \seq z_n}{\Delta} &\equiv \subst{\subst{e}{z_1}{x_1} \seq}{z_n}{x_n} \\
        \subst{e}{x_1 \seq x_n}{e_1 \seq e_n} &\equiv \subst{\subst{e}{x_1}{e_1} \seq}{x_n}{e_n} \\
        \textit{where} ~ \Delta &\equiv (\annot{x_1}{\any}) \seq (\annot{x_n}{\any})
    \end{align*}
    \begin{alignat*}{3}
        \letin{\tt}{\any}{e_2} &\equiv &&\: e_2 \\
        \letin{\pairs{x_1, x_2}{x_n}}{e_1}{e_2} &\equiv &&\: \letin{x_1}{\prjl{e_1}}{ \\
        &&&\quad\letin{\pairs{x_2}{x_n}}{\prjr{e_1}}{e_2}} \\
        \unpack{\alpha_1, \alpha_2}{\seq, \alpha_n, x}{e_1}{e_2} &\equiv &&\: \unpack{\alpha_1}{x_1}{e_1}{ \\
        &&&\quad\unpack{\alpha_2}{\seq, \alpha_n, x}{x_1}{e_2}} \\
        \mathrlap{\textit{where} ~ \fresh{x_1, \seq, x_n}}
    \end{alignat*}
    \caption{Syntactic sugar}
    \label{fig:sugar}
\end{figure}

\begin{figure}[h]
    \centering
    \begin{align*}
        \lub{\Prop{i}}{\Prop{j}} &\equiv \Prop{\maximum(i, j)} \\
        \lub{\Type{i}}{U_{j}} &\equiv \Type{\maximum(i, j)} \\
        \lub{U_{i}}{\Type{j}} &\equiv \Type{\maximum(i, j)} \\
    \end{align*}
    \begin{align*}
        \erase{\fun{x}{\sigma}{\tau}} &\equiv \fun{x}{\erase{\sigma}}{\erase{\tau}} \\
        \erase{\lam{x}{\sigma}{e}} &\equiv \lam{x}{\erase{\sigma}}{\erase{e}} \\
        \erase{\app{e_1}{e_2}} &\equiv \app{\erase{e_1}}{\erase{e_2}} \\
        \erase{\poly{\alpha}{\tau}} &\equiv \erase{\tau} \\
        \erase{\Lam{\alpha}{e}} &\equiv \erase{e} \\
        \erase{\App{e}{s}} &\equiv \erase{e} \\
        \erase{\letin{x}{e_1}{e_2}} &\equiv \letin{x}{\erase{e_1}}{\erase{e_2}} \\
        \erase{\prod{x}{\sigma}{\tau}} &\equiv \prod{x}{\erase{\sigma}}{\erase{\tau}} \\
        \erase{\pair{e_1}{e_2}_{\prod{x}{\sigma}{\tau}}} &\equiv \pair{\erase{e_1}}{\erase{e_2}}_{\prod{x}{\erase{\sigma}}{\erase{\tau}}} \\
        \erase{\prjl{e}} &\equiv \prjl{\erase{e}} \\
        \erase{\prjr{e}} &\equiv \prjr{\erase{e}} \\
        \erase{\some{\alpha}{\tau}} &\equiv \erase{\tau} \\
        \erase{\pack{s}{e}_{\some{\alpha}{\tau}}} &\equiv \erase{e} \\
        \erase{\unpack{\alpha}{x}{e_1}{e_2}} &\equiv \letin{x}{\erase{e_1}}{\erase{e_2}} \\
        \erase{\equal{e_1}{\tau}{e_2}} &\equiv \equal{\erase{e_1}}{\erase{\tau}}{\erase{e_2}} \\
        \erase{\refl_{e}} &\equiv \refl_{\erase{e}} \\
        \erase{\J{P}{d}{p}} &\equiv \J{\erase{P}}{\erase{d}}{\erase{p}} \\
        \erase{e} &\equiv e
    \end{align*}
    \caption{Metafunctions}
    \label{fig:metafunctions}
\end{figure}

\begin{figure}[h]
    \centering
    \begin{mathpar}
        \fbox{$\red{\Gamma}{e}{}{e}$} \hfill \\
        \inferrule[]{
            (\define{x}{e}) \in \Gamma
        }{
            \red{\Gamma}{x}{\delta}{e}
        }
        \and
        \inferrule[]{~}{
            \red{\Gamma}{\app{(\lam{x}{\tau}{e})}{e'}}{\beta}{\subst{e}{x}{e'}}
        }
        \and
        \inferrule[]{~}{
            \red{\Gamma}{\App{(\Lam{\alpha}{e})}{s}}{\beta}{\subst{e}{\alpha}{s}}
        }
        \and
        \inferrule[]{~}{
            \red{\Gamma}{\letin{x}{e'}{e}}{\zeta}{\subst{e}{x}{e'}}
        }
        \and
        \inferrule[]{~}{
            \red{\Gamma}{\prjl{\pair{e_1}{e_2}}}{\pi}{e_1}
        }
        \and
        \inferrule[]{~}{
            \red{\Gamma}{\prjr{\pair{e_1}{e_2}}}{\pi}{e_2}
        }
        \and
        \inferrule[]{~}{
            \red{\Gamma}{\unpack{\alpha}{x}{\pack{s}{e'}}{e}}{\varepsilon}{\subst{\subst{e}{\alpha}{s}}{x}{e'}}
        }
        \and
        \inferrule[]{~}{
            \red{\Gamma}{\J{}{d}{\refl_{}}}{\iota}{d}
        }
    \end{mathpar}
    \caption{Reduction rules}
    \label{fig:reduction}
\end{figure}

\begin{figure}[h]
    \centering
    \begin{mathpar}
        \fbox{$\conv{\Gamma}{s}{s}$} \hfill \\
        \inferrule[]{(\alpha) \in \Gamma}{\conv{\Gamma}{\alpha}{\alpha}}
        \and
        \inferrule[]{
            \conv{\Gamma}{s_1}{s_2}
        }{
            \conv{\Gamma}{\hat{s}_1}{\hat{s}_2}
        }
        \and
        \inferrule[]{~}{\conv{\Gamma}{\circ}{\circ}}
        \and
        \inferrule[]{~}{\conv{\Gamma}{\infty}{\infty}}
        \and
        \inferrule[]{
            \conv{\Gamma}{s}{\infty}
        }{
            \conv{\Gamma}{\hat{s}}{\infty}
        }
        \and
        \inferrule[]{
            \conv{\Gamma}{\infty}{s}
        }{
            \conv{\Gamma}{\infty}{\hat{s}}
        }
    \end{mathpar}
    \caption{Convertibility rules (sizes)}
    \label{fig:conv-size}
\end{figure}

\begin{figure}[h]
    \centering
    \begin{align*}
        \fbox{$\red*{\Gamma}{e}{e}$}
        &&\fbox{$\conv{\Gamma}{e}{e}$}
    \end{align*}
    \caption{Implicit judgements}
    \label{fig:impl-judge}
\end{figure}

\begin{figure}[h]
    \centering
    \begin{mathpar}
        \fbox{$\wf{}{\Gamma}$} \hfill \\
        \inferrule[$\Gamma-$nil]{\wf{}{~}}{\wf{}{\mt}}
        \and
        \inferrule[$\Gamma-$cons-size]{
            \wf{}{\Gamma}
        }{
            \wf{}{\Gamma(\alpha)}
        }
        \and
        \inferrule[$\Gamma-$cons-ass]{
            \wf{}{\Gamma} \\
            \infer{\Gamma}{\tau}{U_{i}}
        }{
            \wf{}{\Gamma(\annot{x}{\tau})}
        }
        \and
        \inferrule[$\Gamma-$cons-def]{
            \wf{}{\Gamma} \\
            \infer{\Gamma}{e}{\tau}
        }{
            \wf{}{\Gamma(\define{x}{e})}
        }
        \\\\
        \fbox{$\wf{}{s}$} \hfill \\
        \inferrule[svar]{
            (\alpha) \in \Gamma
        }{
            \wf{\Gamma}{\alpha}
        }
        \and
        \inferrule[ssucc]{
            \wf{\Gamma}{s}
        }{
            \wf{\Gamma}{\suc{s}}
        }
        \and
        \inferrule[so]{~}{\wf{\Gamma}{\circ}}
        \and
        \inferrule[sinf]{~}{\wf{\Gamma}{\infty}}
    \end{mathpar}
    \caption{Well-formedness rules}
    \label{fig:wf}
\end{figure}

\begin{figure}[h]
    \centering
    \begin{mathpar}
        \fbox{$\type{\Gamma}{e}{\tau}$} \hfill \\
        \inferrule[conv]{
            \infer{\Gamma}{\tau}{U_i} \\
            \infer{\Gamma}{e}{\taupr} \\
            \conv{\Gamma}{\tau}{\taupr}
        }{
            \check{\Gamma}{e}{\tau}
        }
        \and
        \inferrule[var]{
            \wf{}{\Gamma} \\
            (\annot{x}{\tau}) \in \Gamma
        }{
            \infer{\Gamma}{x}{\tau}
        }
        \and
        \inferrule[type]{
            \wf{}{\Gamma}
        }{
            \infer{\Gamma}{U_{i}}{\Type{i+1}}
        }
        \and
        \inferrule[pi]{
            \infer{\Gamma}{\sigma}{U_{i}} \\
            \infer{\Gamma(\annot{x}{\sigma})}{\tau}{U'_{j}}
        }{
            \infer{\Gamma}{\fun{x}{\sigma}{\tau}}{U'_{\maximum(i, j)}}
        }
        \and
        \inferrule[lam]{
            \infer{\Gamma}{\sigma}{U_{i}} \\
            \infer{\Gamma(\annot{x}{\sigma})}{e}{\tau}
        }{
            \infer{\Gamma}{\lam{x}{\sigma}{e}}{\fun{x}{\sigma}{\tau}}
        }
        \and
        \inferrule[app]{
            \infer{\Gamma}{e_1}{\fun{x}{\sigma}{\tau}} \\
            \check{\Gamma}{e_2}{\tau}
        }{
            \infer{\Gamma}{\app{e_1}{e_2}}{\subst{\tau}{x}{e_1}}
        }
        \and
        \inferrule[forall]{
            \infer{\Gamma(\alpha)}{\tau}{U_i}
        }{
            \infer{\Gamma}{\poly{\alpha}{\tau}}{U_i}
        }
        \and
        \inferrule[slam]{
            \infer{\Gamma(\alpha)}{e}{\tau}
        }{
            \infer{\Gamma}{\Lam{\alpha}{e}}{\poly{\alpha}{\tau}}
        }
        \and
        \inferrule[sapp]{
            \infer{\Gamma}{e}{\poly{\alpha}{\tau}} \\
            \wf{\Gamma}{s}
        }{
            \infer{\Gamma}{\App{e}{s}}{\subst{\tau}{\alpha}{s}}
        }
        \and
        \inferrule[let]{
            \infer{\Gamma}{e_1}{\sigma} \\
            \infer{\Gamma(\define{x}{e_1})(\annot{x}{\sigma})}{e_2}{\tau}
        }{
            \infer{\Gamma}{\letin{x}{e_1}{e_2}}{\subst{\tau}{x}{e_1}}
        }
        \and
        \inferrule[sigma]{
            \infer{\Gamma}{\sigma}{U_i} \\
            \infer{\Gamma(\annot{x}{\sigma})}{\tau}{U'_j}
        }{
            \infer{\Gamma}{\prod{x}{\sigma}{\tau}}{U_i \mathbin{\meta{\sqcup}} U'_j}
        }
        \and
        \inferrule[pair]{
            \check{\Gamma}{e_1}{\sigma} \\
            \check{\Gamma}{e_2}{\subst{\tau}{x}{e_1}}
        }{
            \infer{\Gamma}{\pair{e_1}{e_2}_{\prod{x}{\sigma}{\tau}}}{\prod{x}{\sigma}{\tau}}
        }
        \and
        \inferrule[left]{
            \infer{\Gamma}{e}{\prod{x}{\sigma}{\tau}}
        }{
            \infer{\Gamma}{\prjl{e}}{\sigma}
        }
        \and
        \inferrule[right]{
            \infer{\Gamma}{e}{\prod{x}{\sigma}{\tau}}
        }{
            \infer{\Gamma}{\prjr{e}}{\subst{\tau}{x}{\prjl{e}}}
        }
        \and
        \inferrule[exists]{
            \infer{\Gamma(\alpha)}{\tau}{U_i}
        }{
            \infer{\Gamma}{\some{\alpha}{\tau}}{U_i}
        }
        \and
        \inferrule[spair]{
            \wf{\Gamma}{s} \\
            \check{\Gamma}{e}{\subst{\tau}{\alpha}{s}}
        }{
            \infer{\Gamma}{\pack{s}{e}_{\some{\alpha}{\tau}}}{\some{\alpha}{\tau}}
        }
        \and
        \inferrule[unpair]{
            \infer{\Gamma}{e_1}{\some{\alpha}{\sigma}} \\\\
            \infer{\Gamma(\alpha)(\annot{x}{\sigma})}{e_2}{\tau} \\
            \infer{\Gamma}{\tau}{U_i}
        }{
            \infer{\Gamma}{\unpack{\alpha}{x}{e_1}{e_2}}{\tau}
        }
        \and
        \inferrule[eq]{
            \infer{\Gamma}{\tau}{U_i} \\\\
            \check{\Gamma}{e_1}{\tau} \\
            \check{\Gamma}{e_2}{\tau}
        }{
            \infer{\Gamma}{\equal{e_1}{\tau}{e_2}}{U_i}
        }
        \and
        \inferrule[refl]{
            \infer{\Gamma}{e}{\tau}
        }{
            \infer{\Gamma}{\refl_{e}}{\equal{e}{\tau}{e}}
        }
        \and
        \inferrule[J]{
            \infer{\Gamma}{p}{\equal{e_1}{\tau}{e_2}} \\
            \fresh{y, z} \\\\
            \infer{\Gamma(\annot{y}{\tau})(\annot{z}{\equal{e_1}{\tau}{y}})}{\app{\app{P}{y}}{z}}{U_i} \\
            \check{\Gamma}{d}{\app{\app{P}{e_1}}{\refl_{e_1}}} \\
        }{
            \infer{\Gamma}{\J{P}{d}{p}}{\app{\app{P}{e_2}}{p}}
        }
    \end{mathpar}
    \caption{Typing rules}
    \label{fig:typing}
\end{figure}

\begin{figure}[h]
    \centering
    \begin{align*}
        c &\Coloneqq \zero* \mid \succ* \mid \nil* \mid \cons* \\
        e &\Coloneqq \dots \mid \N{s} \mid \zero{s} \mid \succ{s}{e} \mid \V{s}{\tau}{e} \mid \nil{s}{\tau} \mid \cons{s}{e}{e}{e} \\
        &\mid \match{e}{(y_1 \seq y_n).x.P}{(\app{c}{z_1 \seq z_m} \Rightarrow e) \seq} \mid \fix{f}{\tau}{e}
    \end{align*}
    \begin{mathpar}
        \vspace{-1em}
        \fbox{$\red{\Gamma}{e}{}{e}$} ~ \cdots \hfill \\
        \inferrule[]{~}{
            \red{\Gamma}{\match{\zero{\any}}{().\any.\any}{(\zero* \Rightarrow e_z) (\app{\succ*}{\any} \Rightarrow \any)}}{\iota}{e_z}
        }
        \and
        \inferrule[]{~}{
            \red{\Gamma}{\match{\succ{\any}{e}}{().\any.\any}{(\zero* \Rightarrow \any) (\app{\succ*}{z} \Rightarrow e_s)}}{\iota}{\subst{e_s}{z}{e}}
        }
        \and
        \inferrule[]{~}{
            \red{\Gamma}{\match{\nil{\any}{\any}}{(\any).\any.\any}{(\nil* \Rightarrow e_n)(\app{\app{\app{\cons*}{\any}}{\any}}{\any} \Rightarrow \any)}}{\iota}{e_n}
        }
        \and
        \inferrule[]{~}{
            \red{\Gamma}{\match{\cons{\any}{e_1}{e_2}{e_3}}{(\any).\any.\any}{(\nil* \Rightarrow \any)(\app{\app{\app{\cons*}{z_1}}{z_2}}{z_3} \Rightarrow e_c)}}{\iota}{\subst{e_c}{z_1 \et z_2 \et z_3}{e_1 \et e_2 \et e_3}}
        }
    \end{mathpar}
    \begin{mathpar}
        \fbox{$\type{\Gamma}{e}{\tau}$} ~ \cdots \hfill \\
        \inferrule[nat]{
            \wf{}{\Gamma} \\
            \wf{\Gamma}{s}
        }{
            \infer{\Gamma}{\N{s}}{\Type{0}}
        }
        \and
        \inferrule[zero]{
            \wf{}{\Gamma} \\
            \wf{\Gamma}{s}
        }{
            \infer{\Gamma}{\zero{s}}{\N{\hat{s}}}
        }
        \and
        \inferrule[succ]{
            \check{\Gamma}{e}{\N{s}}
        }{
            \infer{\Gamma}{\succ{s}{e}}{\N{\hat{s}}}
        }
        \and
        \inferrule[vec]{
            \wf{\Gamma}{s} \\
            \infer{\Gamma}{\tau}{U_i} \\
            \check{\Gamma}{e}{\N{s}}
        }{
            \infer{\Gamma}{\V{s}{\tau}{e}}{U_i}
        }
        \and
        \inferrule[nil]{
            \wf{\Gamma}{s} \\
            \infer{\Gamma}{\tau}{U_i}
        }{
            \infer{\Gamma}{\nil{s}{\tau}}{\V{\hat{s}}{\tau}{(\zero{s})}}
        }
        \and
        \inferrule[cons]{
            \check{\Gamma}{e_1}{\N{s}} \\
            \infer{\Gamma}{e_2}{\tau} \\
            \check{\Gamma}{e_3}{\V{s}{\tau}{e_1}}
        }{
            \infer{\Gamma}{\cons{s}{e_1}{e_2}{e_3}}{\V{\hat{s}}{\tau}{(\succ{s}{e_1})}}
        }
        \and
        \inferrule[match-nat]{
            \infer{\Gamma}{e}{\N{\hat{s}}} \\
            z \notin \FV(P) \\
            \infer{\Gamma(\annot{x}{\N{\hat{s}}})}{P}{U_i} \\\\
            \check{\Gamma}{e_z}{\subst{P}{x}{\zero{s}}} \\
            \check{\Gamma(\annot{z}{\N{s}})}{e_s}{\subst{P}{x}{\succ{s}{z}}}
        }{
            \infer{\Gamma}{\match{e}{().x.P}{(\zero* \Rightarrow e_z)(\app{\succ*}{z} \Rightarrow e_s)}}{\subst{P}{x}{e}}
        }
        \and
        \inferrule[match-vec]{
            \infer{\Gamma}{e}{\V{\hat{s}}{\tau}{e_N}} \\
            z_1, z_2, z_3 \notin \FV(P) \\\\
            \infer{\Gamma(\annot{y}{\N{\hat{s}}})(\annot{x}{\V{\hat{s}}{\tau}{y}})}{P}{U_i} \\
            \check{\Gamma}{e_n}{\subst{\subst{P}{y}{\zero{s}}}{x}{\nil{s}{\tau}}} \\
            \check{\Gamma(\annot{z_1}{\N{s}})(\annot{z_2}{\tau})(\annot{z_3}{\V{s}{\tau}{z_1}})}{e_c}{\subst{\subst{P}{y}{\succ{s}{z_1}}}{x}{\cons{s}{z_1}{z_2}{z_3}}}
        }{
            \infer{\Gamma}{\match{e}{(y).x.P}{(\nil* \Rightarrow e_n)(\app{\app{\app{\cons*}{z_1}}{z_2}}{z_3} \Rightarrow e_c)}}{\subst{\subst{P}{y}{e_N}}{x}{e}}
        }
        \and
        \inferrule[fix]{
            \infer{\Gamma}{\sigma}{U_{i}} \\
            \red*{\Gamma}{\sigma}{\poly{\alpha}{\sigmapr}} \\
            \sigmapr \equiv \poly{\Phi}{\arr{\Delta}{\arr{(\annot{x}{\tau})}{\taupr}}} \\\\
            \tau \equiv \N{\alpha} ~ \textit{or} ~ \V{\alpha}{\any}{\any} \\
            \check{\Gamma(\alpha)(f : \sigma)}{e}{\subst{\sigma}{\alpha}{\hat{\alpha}}}
        }{
            \infer{\Gamma}{\fix{f}{\sigma}{e}}{\sigma}
        }
    \end{mathpar}
    \caption{Naturals and vectors}
    \label{fig:nats-vecs}
\end{figure}

\begin{figure}[h]
    \centering
    \begin{align*}
        e &\Coloneqq \dots \mid \N* \mid \zero* \mid \app{\succ*}{e}
    \end{align*}
    \vspace{-4em}
    \begin{multicols}{2}
    \begin{align*}
        &\Let{\ind{shiftN1}}{\poly{\alpha}{\arr{\N{\alpha}}{\N{\hat{\alpha}}}}}{ \\
        &\quad \fix{\textit{shiftN1}}{\poly{\alpha}{\arr{\N{\alpha}}{\N{\hat{\alpha}}}}}{ \\
        &\qquad \lam{n}{\N{\hat{\alpha}}}{\match{n}{().\any.\N{\hat{\hat{\alpha}}}}{ \\
        &\quad\qquad (\zero* \Rightarrow \zero{\hat{\alpha}}) \\
        &\quad\qquad (\app{\succ*}{m} \Rightarrow \succ{\hat{\alpha}}{(\app{\textit{shiftN1}}{m})})}}}}
    \end{align*}
    \vfill
    \columnbreak
    \begin{align*}
        &\Let{\ind{shiftN}}{\poly{\alpha}{\arr{\N{\alpha}}{\N*}}}{ \\
        &\quad \fix{\textit{shiftN}}{\poly{\alpha}{\arr{\N{\alpha}}{\N*}}}{ \\
        &\qquad \lam{n}{\N{\hat{\alpha}}}{\match{n}{().\any.\N*}{ \\
        &\quad\qquad (\zero* \Rightarrow \zero*) \\
        &\quad\qquad (\app{\succ*}{m} \Rightarrow \app{\succ*}{(\app{\textit{shiftN}}{m})})}}}}
    \end{align*}
    \vspace*{\fill}
    \end{multicols}
    \vspace{-4em}
    \begin{mathpar}
        \setlength{\jot}{-1pt}
        \fbox{$\type{\Gamma}{e}{\tau} \compilesto e^*$} ~ \cdots \hfill \\
        \inferrule[nat*]{
            \wf{}{\Gamma}
        }{
            \infer{\Gamma}{\N*}{\Type{0}} \compilesto \some{\alpha}{\N{\alpha}}
        }
        \and
        \inferrule[zero*]{
            \wf{}{\Gamma}
        }{
            \infer{\Gamma}{\zero*}{\N*} \compilesto \pack{\circ}{\zero{\circ}}
        }
        \and
        \inferrule[succ*]{
            \check{\Gamma}{e}{\N*} \compilesto e^*
        }{
            \infer{\Gamma}{\app{\succ*}{e}}{\N*} \compilesto \unpack{\alpha}{x}{e^*}{\pack{\hat{\alpha}}{\succ{\alpha}{x}}}
        }
        \and
        \inferrule[match-nat*]{
            \check{\Gamma}{e}{\N*} \compilesto e^* \\
            z \notin \FV(P) \\
            \infer{\Gamma(\annot{x}{\N*})}{P}{U_i} \compilesto P^* \\
            \check{\Gamma}{e_z}{\subst{P}{x}{\zero*}} \compilesto e^*_z \\
            \check{\Gamma(\annot{z}{\N*})}{e_s}{\subst{P}{x}{\app{\succ*}{z}}} \compilesto e^*_s
        }{
            \infer{\Gamma}{
            \begin{aligned}
                &\match{e}{().x.P}{ \\
                &\quad (\zero* \Rightarrow e_z) \\
                &\quad (\app{\succ*}{z} \Rightarrow e_s)}
            \end{aligned}
            }{\subst{P}{x}{e}} \compilesto
            \begin{aligned}
                 &\unpack{\alpha}{y}{e^*}{ \\
                 &\quad \match{\app{\ind{shiftN1}}{y}}{().x.\letin{x}{\pack{\hat{\alpha}}{x}}{P^*}}{ \\
                 &\qquad (\zero* \Rightarrow e^*_z) \\
                 &\qquad (\app{\succ*}{z} \Rightarrow \letin{z}{\pack{\alpha}{z}}{e^*_s})}}
            \end{aligned}
        }
    \end{mathpar}
    \caption{Sugared full naturals}
    \label{fig:sugared}
\end{figure}

\begin{figure}[h]
    {\centering
    \begin{align*}
        X &\Coloneqq \meta*{inductive type names} \\
        c &\Coloneqq \meta*{inductive constructor names} \\
        D &\Coloneqq \data{X}{\arr{\Delta_I}{U_{i}}}{\Delta_c} \\
        e &\Coloneqq \dots \mid \match{e}{(y_1 \seq y_n).x.P}{(\app{c}{z_1 \seq z_m} \Rightarrow e) \seq} \mid \fix*{i}{f}{\tau}{e}
    \end{align*}}
    An inductive data definition $\data{X}{\arr{\Delta_I}{U_{i}}}{\Delta_c}$ is well-formed if the following hold:
    \begin{enumerate}
        \item $X$ does not appear in $\Delta_I$;
        \item For every constructor $(\annot{c}{\tau}) \in \Delta_c$, $\tau$ has the shape $\arr{\Delta_a}{\app{X}{\any \seq}}$;
        \item For every constructor argument $(\annot{x}{\tau}) \in \Delta_a$,
        \begin{itemize}
            \item The inductive type $X$ does not appear in $\tau$; or
            \item $\tau$ has the shape $\arr{\Delta}{\app{X}{\any \seq}}$, where $X$ does not appear in $\Delta$;
        \end{itemize}
        \item $\infer{\mt}{\arr{\Delta_I}{U_i}}{\Type{j}}$ for some universe level $j$;
        \item For every constructor $(\annot{c}{\tau}) \in \Delta_c$, $\check{(\annot{X}{\arr{\Delta_I}{U_i}})}{\tau}{U_i}$.
    \end{enumerate}
    \centering
    \begin{mathpar}
        \vspace{-1em}
        \fbox{$\red{\Gamma}{e}{}{e}$} ~ \cdots \hfill \\
        \inferrule[]{~}{
            \red{\Gamma}{\match{\app{c}{e_1 \seq e_m}}{(\any \seq).\any.\any}{\seq (\app{c}{z_1 \seq z_m} \Rightarrow e) \seq}}{\iota}{\subst{e}{z_1 \seq z_m}{e_1 \seq e_m}}
        }
    \end{mathpar}
    \begin{mathpar}
        \fbox{$\type{\Gamma}{e}{\tau}$} \hfill \\
        {\small \textsc{conv} \and \textsc{var} \and \textsc{type} \and \textsc{pi} \and \textsc{lam} \and \textsc{app} \and \textsc{let}} \and \textit{as above}
        \\
        \inferrule[match]{
            \data{X}{\arr{\Delta_I}{U_{i}}}{\Delta_c} \\\\
            \infer{\Gamma}{e}{\app{X}{\Delta_i}} \\
            \infer{\Gamma\Delta_I(\annot{x}{\app{X}{\Delta_I}})}{\subst{P}{y_1 \seq y_n}{\Delta_I}}{U'_j} \\\\
            \text{For each constructor $c$:} \\
            (\annot{c}{\arr{\Delta_a}{\app{X}{e'_1 \seq e'_n}}}) \in \Delta_c \\\\
            \check{\Gamma\Delta_a}{\subst{e_c}{z_1 \seq z_m}{\Delta_a}}{\subst{\subst{P}{y_1 \seq y_n}{e'_1 \seq e'_n}}{x}{\app{c}{\Delta_a}}}
        }{
            \infer{\Gamma}{\match{e}{(y_1 \seq y_n).x.P}{(\app{c}{z_1 \seq z_m} \Rightarrow e_c) \seq}}{\subst{\subst{P}{y_1 \seq y_n}{e_1 \seq e_n}}{x}{e}}
        }
        \and
        \inferrule[fix]{
            \infer{\Gamma}{\sigma}{U_{i}} \\
            \check{\Gamma(f : \sigma)}{e}{\sigma}
        }{
            \infer{\Gamma}{\fix*{i}{f}{\sigma}{e}}{\sigma}
        }
    \end{mathpar}
    \caption{Model: CIC}
    \label{fig:cic}
\end{figure}

\begin{figure}
    \centering
    \begin{align*}
        &\data{\Size}{\Type{}}{ \\
        &\quad\annot{\base}{\Size} \\
        &\quad\annot{\next}{\arr{\Size}{\Size}}} \\
        \hfill \\
        &\data{\Eq}{\arr*{A}{\Type{}}{\arr*{a, b}{A}{\Type{}}}}{ \\
        &\quad\annot{\refl}{\arr*{A}{\Type{}}{\arr*{a}{A}{\app{\app{\app{\Eq}{A}}{a}}{a}}}}} \\
        \hfill \\
        &\data{\ind{Pair}}{\arr*{A}{\Type{}}{\arr*{B}{\arr{A}{\Type{}}}{\Type{}}}}{ \\
        &\quad \annot{\constr{pair}}{\arr*{A}{\Type{}}{\arr*{B}{\arr{A}{\Type{}}}{\arr*{a}{A}{\arr{\app{B}{a}}{\app{\app{\ind{Pair}}{A}}{B}}}}}}} \\
        \hfill \\
        &\data{\Nat}{\arr{\Size}{\Type{}}}{ \\
        &\quad \annot{\zero*}{\arr*{\alpha}{\Size}{\app{\Nat}{(\app{\next}{\alpha})}}} \\
        &\quad \annot{\succ*}{\arr*{\alpha}{\Size}{\arr{\app{\Nat}{\alpha}}{\app{\Nat}{(\app{\next}{\alpha})}}}}} \\
        \hfill \\
        &\data{\Vec}{\arr{\Type{}}{\arr*{\alpha}{\Size}{\arr{\app{\Nat}{\alpha}}{\Type{}}}}}{ \\
        &\quad \annot{\nil*}{\arr*{A}{\Type{}}{\arr*{\alpha}{\Size}{\app{\app{\app{\Vec}{A}}{(\app{\next}{\alpha})}}{(\app{\zero*}{\alpha})}}}} \\
        &\quad \annot{\cons*}{\arr*{A}{\Type{}}{\arr*{\alpha}{\Size}{\arr*{n}{\app{\Nat}{\alpha}}{\arr{A}{\arr{\app{\app{\app{\Vec}{A}}{\alpha}}{n}}{\app{\app{\app{\Vec}{A}}{(\app{\next}{\alpha})}}{(\app{\app{\succ*}{\alpha}}{n})}}}}}}}}
    \end{align*}
    \caption{Preliminary CIC inductive data}
    \label{fig:cic-data-defs}
\end{figure}

\begin{figure}[h]
    \centering
    \begin{align*}
        &\Let{\ind{subst}}{\arr*{A}{\Type{}}{\arr*{P}{\arr{A}{\Type{}}}{\arr*{x, y }{A}{\arr{\eq{x}{y}}{\arr{\app{P}{x}}{\app{P}{y}}}}}}}{ \\
        &\quad\lam{A}{\Type{}}{\lam{P}{\arr{A}{\Type{}}}{\lam{x}{A}{\lam{y}{A}{\lam{p}{\eq{x}{y}}{ \\
        &\qquad\match{p}{(\any \et x \et y).\any.\arr{\app{P}{x}}{\app{P}{y}}}{ \\
        &\quad\qquad(\app{\app{\refl}{\any}}{x} \Rightarrow \lam{px}{\app{P}{x}}{px})}}}}}}} \\
        \hfill \\
        &\Let{\ind{ap}}{\arr*{A, B}{\Type{}}{\arr*{f}{\arr{A}{B}}{\arr*{x, y}{A}{\arr{\eq{x}{y}}{\eq{\app{f}{x}}{\app{f}{y}}}}}}}{ \\
        &\quad\lam{A}{\Type{}}{\lam{B}{\Type{}}{\lam{f}{\arr{A}{B}}{\lam{x}{A}{\lam{y}{A}{\lam{p}{\eq{x}{y}}{ \\
        &\qquad\match{p}{(\any \et x \et y).\any.\eq{\app{f}{x}}{\app{f}{y}}}{ \\
        &\quad\qquad (\app{\app{\refl}{\any}}{x} \Rightarrow \app{\app{\refl}{B}}{(\app{f}{x})})}}}}}}}} \\
        \hfill \\
        &\Let{\ind{absurd}}{\arr*{A}{\Type{}}{\arr*{\alpha}{\Size}{\arr{\eq{\base}{\app{\next}{\alpha}}}{A}}}}{ \\
        &\quad\lam{A}{\Type{}}{\letin{\textit{discr}}{ \\
        &\qquad\lam{\alpha}{\Size}{\match{\alpha}{().\any.\Type{}}{ \\
        &\quad\qquad(\base \Rightarrow \Size) \\
        &\quad\qquad(\app{\next}{\any} \Rightarrow A)}}}{ \\
        &\quad\lam{\alpha}{\Size}{\lam{p}{\eq{\base}{\app{\next}{\alpha}}}{ \\
        &\qquad\app{\ind{subst}}{\app{\Size}{\app{\textit{discr}}{\app{\base}{\app{(\app{\next}{\alpha})}{\app{p}{\base}}}}}}}}}}} \\
        \hfill \\
        &\Let{\ind{inj}}{\arr*{\alpha, \beta}{\Size}{\arr{\eq{\app{\next}{\alpha}}{\app{\next}{\beta}}}{\eq{\alpha}{\beta}}}}{ \\
        &\quad\letin{\textit{pred}}{ \\
        &\qquad\lam{\beta}{\Size}{\match{\beta}{().\any.\Size}{ \\
        &\quad\qquad(\base \Rightarrow \base) \\
        &\quad\qquad(\app{\next}{\beta'} \Rightarrow \beta')}}}{ \\
        &\quad\lam{\alpha}{\Size}{\lam{\beta}{\Size}{\lam{p}{\eq{\app{\next}{\alpha}}{\app{\next}{\beta}}}{ \\
        &\qquad\app{\app{\app{\app{\app{\app{\ind{ap}}{\Size}}{\Size}}{\textit{pred}}}{(\app{\next}{\alpha})}}{(\app{\next}{\beta})}}{p}}}}}}
    \end{align*}
    \textit{where} $\eq{e_1}{e_2} \equiv \app{\app{\app{\Eq}{\any}}{e_1}}{e_2}$, type inferred from context
    \caption{Preliminary CIC definitions (1/2)}
    \label{fig:cic-defs-1}
\end{figure}

\begin{figure}[h]
    \centering
    \begin{align*}
        &\Let{\ind{substInj}}{\arr*{P}{\arr{\Size}{\Type{}}}{\arr*{\alpha, \beta}{\Size}{\arr{\eq{\app{\next}{\alpha}}{\app{\next}{\beta}}}{\arr{\app{P}{\alpha}}{\app{P}{\beta}}}}}}{ \\
        &\quad\lam{P}{\arr{\Size}{\Type{}}}{\lam{\alpha}{\Size}{\lam{\beta}{\Size}{\lam{p}{\eq{\app{\next}{\alpha}}{\app{\next}{\beta}}}{ \\
        &\qquad \app{\app{\app{\app{\app{\ind{subst}}{\Size}}{P}}{\alpha}}{\beta}}{(\app{\app{\app{\ind{inj}}{\alpha}}{\beta}}{p})}}}}}} \\
        \hfill \\
        &\Let{\ind{absurdNatBase}}{\arr*{x}{\app{\Nat}{\base}}{\arr*{A}{\Type{}}{A}}}{ \\
        &\quad \lam{x}{\app{\Nat}{\base}}{\lam{A}{\Type{}}{ \\
        &\qquad
        \left[
        \begin{aligned}
            &\match{x}{(\alpha).\any.\arr{\eq{\base}{\alpha}}{A}}{ \\
            &\quad (\app{\zero*}{\alpha} \Rightarrow \app{\app{\ind{absurd}}{A}}{\alpha}) \\
            &\quad (\app{\app{\succ*}{\alpha}}{\any} \Rightarrow \app{\app{\ind{absurd}}{A}}{\alpha})}
        \end{aligned}
        \right]
        (\app{\app{\refl}{\Size}}{\base})}}} \\
        \hfill \\
        &\Let{\ind{elim}}{\arr*{P}{\arr{\Size}{\Type{}}}{\arr{\app{P}{\base}}{\arr{(\arr*{\alpha}{\Size}{\arr{\app{P}{\alpha}}{\app{P}{(\app{\next}{\alpha})}}})}{\arr*{\alpha}{\Size}{\app{P}{\alpha}}}}}}{ \\
        }&\quad\lam{P}{\arr{\Size}{\Type{}}}{\lam{pb}{\app{P}{\base}}{\lam{pn}{\arr*{\alpha}{\Size}{\arr{\app{P}{\alpha}}{\app{P}{(\app{\next}{\alpha})}}}}{ \\
        &\qquad\fix{\textit{elim}}{\arr*{\alpha}{\Size}{\app{P}{\alpha}}}{ \\
        &\quad\qquad \lam{\alpha}{\Size}{\match{\alpha}{().\alpha.\app{P}{\alpha}}{ \\
        &\qquad\qquad (\base \Rightarrow pb) \\
        &\qquad\qquad (\app{\next}{\alphapr} \Rightarrow \app{pn}{(\app{\textit{elim}}{\alphapr})})}}}}}}
    \end{align*}
    \textit{where} $\eq{e_1}{e_2} \equiv \app{\app{\app{\Eq}{\any}}{e_1}}{e_2}$, type inferred from context
    \caption{Preliminary CIC definitions (2/2)}
    \label{fig:cic-defs-2}
\end{figure}

\begin{figure}[h]
    \centering
    \begin{align*}
        \fbox{$\compile{s} = e^*$} \hfill \\
        \compile{\alpha} &= \alpha \\
        \compile{\circ} &= \base \\
        \compile{\hat{s}} &= \app{\next}{\compile{s}} \\
        \mathclap{\fbox{$\compile{e} = e^*$} ~ \textit{where} ~ \infer{\Gamma}{e}{\any} \compilesto e^* \hfill} \\
        \compile{x} &= x \\
        \compile{U_i} &= U_i \\
        \compile{\fun{x}{\sigma}{\tau}} &= \fun{x}{\compile{\sigma}}{\compile{\tau}} \\
        \compile{\lam{x}{\sigma}{e}} &= \lam{x}{\compile{\sigma}}{\compile{e}} \\
        \compile{\app{e_1}{e_2}} &= \app{\compile{e_1}}{\compile{e_2}} \\
        \compile{\poly{\alpha}{\tau}} &= \fun{\alpha}{\Size}{\compile{\tau}} \\
        \compile{\Lam{\alpha}{e}} &= \lam{\alpha}{\Size}{\compile{e}} \\
        \compile{\App{e}{s}} &= \app{\compile{e}}{\compile{s}} \\
        \compile{\letin{x}{e_1}{e_2}} &= \letin{x}{\compile{e_1}}{\compile{e_2}} \\
        \compile{\prod{x}{\sigma}{\tau}} &= \app{\app{\ind{Pair}}{\compile{\sigma}}}{(\lam{x}{\compile{\sigma}}{\compile{\tau}})} \\
        \compile{\pair{e_1}{e_2}_{\prod{x}{\sigma}{\tau}}} &= \app{\app{\app{\app{\constr{pair}}{\compile{\sigma}}}{(\lam{x}{\compile{\sigma}}{\compile{\tau}})}}{\compile{e_1}}}{\compile{e_2}} \\
        \compile{\prjl{e}} &= \match{\compile{e}}{(x \et \any).\any.x}{(\app{\app{\app{\app{\constr{pair}}{\any}}{\any}}{x}}{\any} \Rightarrow x)} \\
        \compile{\prjr{e}} &= \match{\compile{e}}{(\any \et y).\any.\app{y}{\compile{\prjl{e}}}}{(\app{\app{\app{\app{\constr{pair}}{\any}}{\any}}{\any}}{y} \Rightarrow y)} \\
        \compile{\some{\alpha}{\tau}} &= \app{\app{\ind{Pair}}{\Size}}{(\lam{x}{\Size}{\compile{\tau}})} \\
        \compile{\pack{s}{e}} &= \app{\app{\app{\app{\constr{pair}}{\Size}}{(\lam{x}{\Size}{\compile{\tau}})}}{\compile{s}}}{\compile{e}} \\
        \compile{\equal{e_1}{\tau}{e_2}} &= \app{\app{\app{\Eq}{\compile{\tau}}}{\compile{e_1}}}{\compile{e_2}}
    \end{align*}
    \begin{mathpar}
        \fbox{$\type{\Gamma}{e}{\tau} \compilesto e^*$} \hfill \\
        \inferrule[conv*]{
            \infer{\Gamma}{e}{\tau'} \compilesto e^*
        }{
            \check{\Gamma}{e}{\tau} \compilesto e^*
        }
        \and
        \inferrule[unpair*]{
            \infer{\Gamma}{e_1}{\some{\alpha}{\sigma}} \compilesto e^*_1 \\
            \infer{\Gamma(\alpha)(\annot{x}{\sigma})}{e_2}{\tau} \compilesto e^*_2 \\
            \infer{\Gamma}{\tau}{U_i} \compilesto \tau^*
        }{
            \infer{\Gamma}{\unpack{\alpha}{x}{e_1}{e_2}}{\tau} \compilesto \match{e^*_1}{(\any \et \any).\any.\tau^*}{(\app{\app{\app{\app{\constr{pair}}{\any}}{\any}}{\alpha}}{x} \Rightarrow e^*_2)}
        }
        \and
        \inferrule[refl*]{
            \infer{\Gamma}{e}{\tau} \compilesto e^* \\
            \infer{\Gamma}{\tau}{U_i} \compilesto \tau^*
        }{
            \infer{\Gamma}{\refl_{e}}{\equal{e}{\tau}{e}} \compilesto \app{\app{\refl}{\tau^*}}{e^*}
        }
        \and
        \inferrule[J*]{
            \infer{\Gamma}{p}{\equal{e_1}{\tau}{e_2}} \compilesto p^* \\
            \check{\Gamma}{e_1}{\tau} \compilesto e^*_1 \\
            \fresh{x, y, z} \\\\
            \infer{\Gamma(\annot{y}{\tau})(\annot{z}{\equal{e_1}{\tau}{y}})}{\app{\app{P}{y}}{z}}{U_i} \compilesto P^* \\
            \check{\Gamma}{d}{\app{\app{P}{e_1}}{\refl_{e_1}}} \compilesto d^*
        }{
            \infer{\Gamma}{\J{P}{d}{p}}{\app{\app{P}{e_2}}{p}} \compilesto \match{p^*}{(\any \et x \et y).z.\letin{x}{e^*_1}{\app{\app{P}{y}}{z}}}{(\app{\app{\refl}{\any}}{\any} \Rightarrow d^*)}
        }
    \end{mathpar}
    \caption{Model in CIC (1/2)}
    \label{fig:model-in-cic}
\end{figure}

\begin{figure}
    \centering
    \begin{align*}
        \mathclap{\fbox{$\compile{e} = e^*$} ~ \textit{where} ~ \infer{\Gamma}{e}{\any} \compilesto e^* \hfill} \\
        \compile{\N{s}} &= \app{\Nat}{\compile{s}} \\
        \compile{\zero{s}} &= \app{\zero*}{\compile{s}} \\
        \compile{\succ{s}{e}} &= \app{\app{\succ*}{\compile{s}}}{\compile{e}} \\
        \compile{\V{s}{\tau}{e}} &= \app{\app{\app{\Vec}{\compile{s}}}{\compile{\tau}}}{\compile{e}} \\
        \compile{\nil{s}{\tau}} &= \app{\app{\nil*}{\compile{\tau}}}{\compile{s}}
    \end{align*}
    \begin{mathpar}
        \setlength{\jot}{-1pt}
        \fbox{$\type{\Gamma}{e}{\tau} \compilesto e^*$} \hfill \\
        \inferrule[cons*]{
            \check{\Gamma}{e_1}{\N{s}} \compilesto e^*_1 \\
            \infer{\Gamma}{e_2}{\tau} \compilesto e^*_2 \\
            \check{\Gamma}{e_3}{\V{s}{\tau}{e_1}} \compilesto e^*_3 \\
            \infer{\Gamma}{\tau}{U_i} \compilesto \tau^*
        }{
            \infer{\Gamma}{\cons{s}{e_1}{e_2}{e_3}}{\V{\hat{s}}{\tau}{(\succ{s}{e_1})}} \compilesto \app{\app{\app{\app{\app{\cons*}{\tau^*}}{\compile{s}}}{e^*_1}}{e^*_2}}{e^*_3}
        }
        \and
        \inferrule[match-nat*]{
            \infer{\Gamma}{e}{\N{\hat{s}}} \compilesto e^* \\
            \infer{\Gamma(\annot{x}{\N{\hat{s}}})}{P}{U_i} \compilesto P^* \\
            \check{\Gamma}{e_z}{\subst{P}{x}{\zero{s}}} \compilesto e^*_z \\
            \check{\Gamma(\annot{z}{\N{s}})}{e_s}{\subst{P}{x}{\succ{s}{z}}} \compilesto e^*_s
            \fresh{\beta, q}
        }{
            \infer{\Gamma}{
            \begin{aligned}
                &\match{e}{().x.P}{ \\
                &\quad (\zero* \Rightarrow e_z) \\
                &\quad (\app{\succ*}{z} \Rightarrow e_s)}
            \end{aligned}
            }{\subst{P}{x}{e}} \compilesto
            \left[
            \begin{aligned}
                &(\match{e^*}{(\beta).x.\arr{\eq{\beta}{\app{\next}{\compile{s}}}}{P^*}}{ \\
                &\quad (\app{\zero*}{\beta} \Rightarrow \lam{\any}{\eq{\app{\next}{\beta}}{\app{\next}{\compile{s}}}}{e^*_z}) \\
                &\quad (\app{\app{\succ*}{\beta}}{z} \Rightarrow \lam{q}{\eq{\app{\next}{\beta}}{\app{\next}{\compile{s}}}}{ \\
                &\qquad \letin{z}{\app{\app{\app{\app{\app{\ind{substInj}}{\Nat}}{\beta}}{\compile{s}}}{q}}{z}}{e^*_s}})})
            \end{aligned}
            \right]
            (\app{\app{\refl}{\Size}}{\compile{\hat{s}}})
        }
        \and
        \iffalse
        \inferrule[match-vec*]{
            \infer{\Gamma}{e}{\V{\hat{s}}{\tau}{e_N}} \\
            z_1, z_2, z_3 \notin \FV(P) \\\\
            \infer{\Gamma(\annot{y}{\N{\hat{s}}})(\annot{x}{\V{\hat{s}}{\tau}{y}})}{P}{U_i} \\
            \check{\Gamma}{e_n}{\subst{\subst{P}{y}{\zero{s}}}{x}{\nil{s}{\tau}}} \\
            \check{\Gamma(\annot{z_1}{\N{s}})(\annot{z_2}{\tau})(\annot{z_3}{\V{s}{\tau}{z_1}})}{e_c}{\subst{\subst{P}{y}{\succ{s}{z_1}}}{x}{\cons{s}{z_1}{z_2}{z_3}}}
        }{
            \infer{\Gamma}{\match{e}{(y).x.P}{(\nil* \Rightarrow e_n)(\app{\app{\app{\cons*}{z_1}}{z_2}}{z_3} \Rightarrow e_c)}}{\subst{\subst{P}{y}{e_N}}{x}{e}}
        }
        \and
        \fi
        \inferrule[fix-nat*]{
            \infer{\Gamma(\alpha)}{\sigma}{U_{i}} \compilesto \sigma^* \\
            \red*{\Gamma(\alpha)}{\sigma^*}{\poly{\Phi}{\arr{\Delta}{\arr{(\annot{x}{\N{\alpha}})}{\tau}}}} \\
            \check{\Gamma(\alpha)(f : \sigma)}{e}{\subst{\sigma}{\alpha}{\hat{\alpha}}} \compilesto e^*
        }{
            \infer{\Gamma}{\fix{f}{\poly{\alpha}{\sigma}}{e}}{\sigma} \compilesto
            \begin{aligned}
                &\app{\app{\app{\ind{elim}}{(\lam{\alpha}{\Size}{\sigma^*})}}{ \\
                &\quad (\lam*{\Phi}{\lam*{\subst{\Delta}{\alpha}{\base}}{\lam{x}{\app{\Nat}{\base}}{ \\
                &\qquad\app{\app{\ind{absurdNatBase}}{x}}{\subst{\tau}{\alpha}{\base}}}}})}}{ \\
                &\quad (\lam{\alpha}{\Size}{\lam{f}{\sigma^*}{e^*}})}
            \end{aligned}
        }
    \end{mathpar}
    \caption{Model in CIC (2/2)}
    \label{fig:model-in-cic-nats-vecs}
\end{figure}

\phantom{\cite{nbe-sized}}
%\printbibliography[title=References]

\begin{appendices}

\end{appendices}

\end{document}
