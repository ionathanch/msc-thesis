\ProvidesPackage{style}

% required packages
\RequirePackage{xspace}
\RequirePackage{xcolor}
\RequirePackage{suffix}
\RequirePackage{mathtools}
\RequirePackage{stmaryrd}
\RequirePackage{mathpartir}

% \newcmd*{\cmd}[n]{expression} defines the suffixed command \cmd*
% similarly for \newcmd<
\WithSuffix\newcommand\newcmd*[3]{\WithSuffix\newcommand#1*#2{#3}}
\WithSuffix\newcommand\newcmd<[3]{\WithSuffix\newcommand#1<#2{#3}}

% rule labels:
% \rlabel{name}{label} creates given label and prints name
% \rref{label} prints "Rule <name>"
% \rref{label, label} prints "Rules <name> and <name>"
% \rref{label, ..., label} prints "Rules <name>, ..., and <name>"
\newcounter{nrules}
\newcommand{\rlabel}[2]{%
  \edef\@currentlabelname{#1}%
  \phantomsection\label{#2}#1%
}
\newcommand{\rref}[1]{
  \setcounter{nrules}{0}
  \@for\rule:={#1}\do{\addtocounter{nrules}{1}}
  \ifcase \value{nrules}
  \or Rule~\nameref{#1}
  \or Rules\@for\rule:={\zap@space #1 \@empty}\do{
    \ifcase \value{nrules}
    \or and \nameref{\rule}%
    \else \nameref{\rule}%
    \fi
    \addtocounter{nrules}{-1}%
  }
  \else Rules\@for\rule:={\zap@space #1 \@empty}\do{
    \ifcase \value{nrules}
    \or and \nameref{\rule}%
    \else \nameref{\rule},%
    \fi
    \addtocounter{nrules}{-1}%
  }
  \fi
}

% colours for:
% - metafunctions (pale magenta)
% - keywords (golden yellow)
% - constants (soft blue)
% - constructions (turquoise)
% - target language (dark orange)
% by Okabe and Ito (https://jfly.uni-koeln.de/color/#pallet)
\definecolor{metacolour}{HTML}{CC79A7}
\definecolor{kwcolour}{HTML}{E69F00}
\definecolor{constcolour}{HTML}{0072B2}
\definecolor{constrcolour}{HTML}{009E73}
\definecolor{targetcolour}{HTML}{D55E00}

% various theorem environments
\newtheorem{theorem}{Theorem}[section]
\newtheorem{lemma}[theorem]{Lemma}
\newtheorem{fact}[theorem]{Fact}

% foreign phrases
\newcommand{\eg}{\emph{e.g.}\xspace}
\newcommand{\ie}{\emph{i.e.}\xspace}
\newcommand{\etal}{\emph{et al.}\xspace}
\newcommand{\ala}{\emph{\`a la}\xspace}
\newcommand{\TODO}{\meta{\texttt{TODO}}\xspace}

% language names
\newcommand{\lang}{$\widehat{\mathrm{TT}}$\xspace}
\newcommand{\GCC}{CC$^\omega$\xspace}
\newcommand{\Fstar}{F$\star$\xspace}
\newcommand{\lambdahat}{$\lambda\widehat{~}$\xspace}
\newcommand{\Fhat}{F$\widehat{~}$\xspace}
\newcommand{\Fhatomega}{F$\widehat{_\omega}$\xspace}
\newcommand{\Fhattimes}{F$\widehat{_{\times}}$\xspace}
\newcommand{\Fcopomega}{F$^{\textrm{cop}}_{\omega}$\xspace}
\newcommand{\CICE}{CIC$_E$\xspace}
\newcommand{\CIChat}{CIC$\widehat{~}$\xspace}
\newcommand{\CIChatminus}{CIC$\widehat{_-}$\xspace}
\newcommand{\CChatomega}{CC$\widehat{\omega}$\xspace}
\newcommand{\CIChatstar}{CIC$\widehat{\ast}$\xspace}
\newcommand{\CIChatl}{CIC$\widehat{_\ell}$}

% styling
\newcommand{\meta}[1]{\textcolor{metacolour}{#1}}
\newcommand{\kw}[1]{\mathsf{\textcolor{kwcolour}{#1}}}
\newcommand{\const}[1]{\mathsf{\textcolor{constcolour}{#1}}}
\newcommand{\constr}[1]{\mathsf{\textcolor{constrcolour}{#1}}}
\newcommand{\target}[1]{\begingroup%
  \definecolor{metacolour}{named}{targetcolour}
  \definecolor{kwcolour}{named}{targetcolour}
  \definecolor{constcolour}{named}{targetcolour}
  \definecolor{constrcolour}{named}{targetcolour}
  \renewcommand{\mathsf}{\mathtt}
  \mathtt{{\textcolor{targetcolour}{#1}}}
\endgroup}

% delimiters
\DeclarePairedDelimiter{\sqbr}{[}{]}
\DeclarePairedDelimiter{\set}{\{}{\}}

% metafunctions
\newcommand{\subst}[3]{#1\mathopen{\meta{[}}#2 \mathrel{\meta{\mapsto}} #3\mathclose{\meta{]}}}
\newcommand{\compile}[1]{\mathopen{\meta{\llbracket}} #1 \mathclose{\meta{\rrbracket}}}

% source language
\newcommand{\@et}{\:}
\newcommand{\Type}[1]{\const{Type}_{#1}}
\newcommand{\Prop}{\const{Prop}}
\newcommand{\sss}[1]{\widehat{#1}}
\newcommand{\app}[1]{#1\@ifnextchar\bgroup{\@et\app}{\xspace}}
\newcommand{\@pp}[1]{\sqbr{#1}\@ifnextchar\bgroup{\@et\@app}{\xspace}}
\newcommand{\App}[1]{#1\@ifnextchar\bgroup{\@et\@pp}{\xspace}}
\newcommand{\fun}[3]{\lambda #1 \mathrel{:} #2 \mathpunct{.} #3}
\newcommand{\Fun}[2]{\Lambda #1 \mathpunct{.} #2}
\newcmd<{\Fun}[3]{\Lambda #1 \mathrel{<} #2 \mathpunct{.} #3}
\newcommand{\funtype}[3]{\Pi #1 \mathrel{:} #2 \mathpunct{.} #3}
\newcommand{\Funtype}[2]{\forall #1 \mathpunct{.} #2}
\newcmd<{\Funtype}[3]{\forall #1 \mathrel{<} #2 \mathpunct{.} #3}
\newcommand{\arr}[3]{\mathopen{(} #1 \mathrel{:} #2 \mathclose{)} \mathrel{\rightarrow} \phantom{} #3}
\newcmd*{\arr}[1]{#1\@ifnextchar\bgroup{\mathrel{\rightarrow}\arr*}{\xspace}}
\newcommand{\letin}[4]{\kw{let} \@et #1 \mathrel{\coloneqq} \phantom{} #3 \@et \kw{in} \@et #4}
\newcommand{\Let}[3]{\kw{let} \@et #1 \mathrel{:} #2 \mathrel{\coloneqq} \phantom{} #3}
\newcommand{\eq}[3]{#1 \stackrel{#2}{=\joinrel=} #3}
\newcommand{\refl}[1]{\constr{refl}_{#1}}
\newcommand{\J}[3]{\constr{J}_{#1} \@et #2 \@et #3}
\newcommand{\N}[1]{\App{\const{\mathbb{N}}}{#1}}
\newcommand{\List}[1]{\app{\const{List}}{#1}}
\newcommand{\fix}[5]{\kw{fix}_{#1} \@et #2 \@et \sqbr{#3} \mathrel{:} #4 \mathrel{\coloneqq} \phantom{} #5}

% source judgements
\newcommand{\wf}[2]{#1 \mathrel{\vdash} #2}
\renewcommand{\check}[3]{#1 \mathrel{\vdash} #2 \mathrel{:} #3}
\renewcommand{\infer}[3]{#1 \mathrel{\vdash} #2 \mathrel{:} #3}
\newcommand{\type}[3]{#1 \mathrel{\vdash} #2 \mathrel{:} #3}
\newcommand{\defeq}[4]{#1 \mathrel{\vdash} #2 \mathrel{\equiv} #3 \mathrel{:} #4}
\newcommand{\subtype}[3]{#1 \mathrel{\vdash} #2 \mathrel{\preccurlyeq} #3}
\newcommand{\cumul}[2]{#1 \mathrel{\sqsubseteq} #2}
\newcommand{\red}[4][]{#2 \mathrel{\vdash} #3 \mathrel{\rhd}_{#1} #4}
\newcmd*{\red}[3]{#1 \mathrel{\vdash} #2 \mathrel{\rhd^*} #3}